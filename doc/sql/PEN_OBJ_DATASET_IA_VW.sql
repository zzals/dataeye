
CREATE OR REPLACE VIEW PEN_OBJ_DATASET_IA_VW 
AS WITH DS_TAB 
AS 
(
    SELECT T01.OBJ_TYPE_ID AS DS_OBJ_TYPE_ID
               , T01.OBJ_ID AS DS_OBJ_ID 
               , T01.OBJ_NM AS DS_OBJ_NM 
               , T03.OBJ_TYPE_ID AS TAB_OBJ_TYPE_ID
               , T03.OBJ_ID AS TAB_OBJ_ID 
               , T03.OBJ_NM AS TAB_OBJ_NM 
    FROM PEN_OBJ_M T01 
    JOIN PEN_OBJ_R T02 
    ON (
        T02.OBJ_TYPE_ID IN ('020102L','020103L','020202L') 
        AND T01.OBJ_TYPE_ID = T02.REL_OBJ_TYPE_ID 
        AND T01.OBJ_ID = T02.REL_OBJ_ID 
        AND T02.DEL_YN = 'N'
    )
    JOIN PEN_OBJ_M T03 
    ON (
        T03 .OBJ_TYPE_ID IN ('020102L','020103L','020202L') 
        AND T02.OBJ_TYPE_ID = T03.OBJ_TYPE_ID 
        AND T02.OBJ_ID = T03.OBJ_ID 
        AND T03.DEL_YN = 'N'
    ) 
    WHERE T01.OBJ_TYPE_ID IN ('010201L','010205L') 
    AND T01.DEL_YN = 'N'
) 
, TAB_TAB 
AS (
    SELECT T00.OBJ_TYPE_ID   AS SRC_TAB_OBJ_TYPE_ID
               , T05.OBJ_TYPE_NM AS SRC_TAB_OBJ_TYPE_NM
               , T00.OBJ_ID             AS SRC_TAB_OBJ_ID
               , T00.OBJ_NM           AS SRC_TAB_OBJ_NM
               , T02.OBJ_TYPE_ID   AS TGT_TAB_OBJ_TYPE_ID
               , T03.OBJ_TYPE_NM AS TGT_TAB_OBJ_TYPE_NM
               , T02.OBJ_ID             AS TGT_TAB_OBJ_ID
               , T02.OBJ_NM           AS TGT_TAB_OBJ_NM
               , SUBSTR(SYS_CONNECT_BY_PATH(T02.OBJ_NM, ' > '), 4) AS FULL_PATH_OBJ_NM
               , LEVEL AS LVL
               , CASE WHEN CONNECT_BY_ISLEAF = 1 THEN 'Y'
                    ELSE 'N'
                END AS LEAF_YN
    FROM PEN_OBJ_R T01
    JOIN PEN_OBJ_M T02 ON (T01.REL_OBJ_TYPE_ID = T02.OBJ_TYPE_ID AND T01.REL_OBJ_ID = T02.OBJ_ID AND T02.DEL_YN = 'N')
    JOIN PEN_OBJ_TYPE_M T03 ON (T02.OBJ_TYPE_ID = T03.OBJ_TYPE_ID)
    JOIN PEN_REL_TYPE_M T04 ON (T01.OBJ_TYPE_ID = T04.OBJ_TYPE_ID AND T01.REL_OBJ_TYPE_ID = T04.REL_OBJ_TYPE_ID AND T04.META_REL_CD = 'FT')
    JOIN PEN_OBJ_M T00 ON (T01.OBJ_TYPE_ID = T00.OBJ_TYPE_ID AND T01.OBJ_ID = T00.OBJ_ID AND T00.DEL_YN = 'N')
    JOIN PEN_OBJ_TYPE_M T05 ON (T00.OBJ_TYPE_ID = T05.OBJ_TYPE_ID)
    WHERE T01.DEL_YN = 'N'
    AND T01.OBJ_TYPE_ID IN ('020102L','020103L','020202L')
    AND T02.OBJ_TYPE_ID IN ('020102L','020103L','020202L')
    CONNECT BY NOCYCLE
    PRIOR T01.REL_OBJ_TYPE_ID = T01.OBJ_TYPE_ID AND PRIOR T01.REL_OBJ_ID = T01.OBJ_ID
    START WITH T00.OBJ_TYPE_ID IN ('020102L','020103L','020202L')
)
SELECT DISTINCT
             T01.DS_OBJ_TYPE_ID     AS SRC_DS_OBJ_TYPE_ID
           , T01.DS_OBJ_ID               AS SRC_DS_OBJ_ID
           , T01.DS_OBJ_NM             AS SRC_DS_OBJ_NM
           , T03.DS_OBJ_TYPE_ID     AS TGT_DS_OBJ_TYPE_ID
           , T03.DS_OBJ_ID               AS TGT_DS_OBJ_ID
           , T03.DS_OBJ_NM             AS TGT_DS_OBJ_NM
FROM DS_TAB T01
JOIN TAB_TAB T02 ON (T01.TAB_OBJ_TYPE_ID = T02.SRC_TAB_OBJ_TYPE_ID AND T01.TAB_OBJ_ID = T02.SRC_TAB_OBJ_ID)
JOIN DS_TAB T03 ON (T02.TGT_TAB_OBJ_TYPE_ID = T03.TAB_OBJ_TYPE_ID AND T02.TGT_TAB_OBJ_ID = T03.TAB_OBJ_ID)
;